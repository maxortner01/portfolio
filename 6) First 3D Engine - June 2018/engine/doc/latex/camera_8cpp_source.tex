\section{camera.\+cpp}
\label{camera_8cpp_source}\index{src/engine/controllers/camera.\+cpp@{src/engine/controllers/camera.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "camera.h"}
00002 
00003 Camera::Camera() \{
00004     \textcolor{keywordtype}{int} width, height;
00005     width  = Engine::window->getWidth();
00006     height = Engine::window->getHeight();
00007 
00008     \textcolor{comment}{/* Changable settings */}
00009     FOV               = 70.0; 
00010     mouse\_sensitivity = .1;
00011     
00012     fog\_start = 100;   \textcolor{comment}{//Fog end = fog\_start + fog\_distance}
00013     fog\_distance = 100;
00014 
00015     aspectRatio = float(width) / float(height);
00016     zNear = .1;
00017 
00018     projectionMatrix = genProjection();
00019     transform        = \textcolor{keyword}{new} Transform(0, 0, 0);
00020 
00021     transform->addTranslation(vec3(-.5, 0, 0));
00022     Mouse::setMousePos(Window::getWidth() / 2, Window::getHeight() / 2);
00023 \}
00024 
00025 mat4 Camera::genProjection() \{
00026     \textcolor{keywordflow}{return} infinitePerspective(FOV, aspectRatio, zNear);
00027 \}
00028 
00029 mat4 Camera::getViewMatrix() \{
00030     vec3 cameraTarget(0, 0, 0);
00031     vec3 front       (0, 0, 1);
00032     vec3 up          (0, 1, 0);
00033     mat4 view        (1.0);
00034 
00035     vec3 position = transform->getPosition();
00036     vec3 rotation = transform->getRotation();
00037 
00038     vec3 direction = normalize(position - cameraTarget);
00039 
00040     vec3 cameraRight = normalize(cross(up, direction));
00041     vec3 cameraUp = cross(direction, cameraRight);
00042 
00043     front.y = std::sin(radians(rotation.y));
00044     front.x = std::cos(radians(rotation.y)) * std::cos(radians(rotation.x));
00045     front.z = std::cos(radians(rotation.y)) * std::sin(radians(rotation.x));
00046 
00047     front = normalize(front);
00048 
00049     view = lookAt(position, position + front, cameraUp);
00050 
00051     \textcolor{keywordflow}{return} view;
00052 \}
00053 
00054 \textcolor{keywordtype}{void} Camera::moveForward(\textcolor{keywordtype}{float} speed) \{
00055     vec3 rotation = transform->getRotation();
00056 
00057     \textcolor{keywordtype}{float} x = speed * std::cos(radians(rotation.x));
00058     \textcolor{keywordtype}{float} z = speed * std::sin(radians(rotation.x));
00059 
00060     vec3 movement = vec3(x, 0, z);
00061 
00062     transform->addTranslation(movement);
00063 \}
00064 
00065 \textcolor{keywordtype}{void} Camera::moveBackward(\textcolor{keywordtype}{float} speed) \{
00066     vec3 rotation = transform->getRotation();
00067 
00068     \textcolor{keywordtype}{float} x = speed * std::cos(radians(rotation.x + 180));
00069     \textcolor{keywordtype}{float} z = speed * std::sin(radians(rotation.x + 180));
00070 
00071     vec3 movement = vec3(x, 0, z);
00072 
00073     transform->addTranslation(movement);
00074 \}
00075 
00076 \textcolor{keywordtype}{void} Camera::moveLeft(\textcolor{keywordtype}{float} speed) \{
00077     vec3 rotation = transform->getRotation();
00078 
00079     \textcolor{keywordtype}{float} x = speed * std::cos(radians(rotation.x - 90));
00080     \textcolor{keywordtype}{float} z = speed * std::sin(radians(rotation.x - 90));
00081 
00082     vec3 movement = vec3(x, 0, z);
00083 
00084     transform->addTranslation(movement);
00085 \}
00086 
00087 \textcolor{keywordtype}{void} Camera::moveRight(\textcolor{keywordtype}{float} speed) \{
00088     vec3 rotation = transform->getRotation();
00089 
00090     \textcolor{keywordtype}{float} x = speed * std::cos(radians(rotation.x + 90));
00091     \textcolor{keywordtype}{float} z = speed * std::sin(radians(rotation.x + 90));
00092 
00093     vec3 movement = vec3(x, 0, z);
00094 
00095     transform->addTranslation(movement);
00096 \}
00097 
00098 \textcolor{keywordtype}{void} Camera::Pollevents() \{
00099     \textcolor{keywordtype}{float} speed = .1;
00100 
00101     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_LSHIFT)) \{
00102         speed = .2;
00103     \}
00104 
00105     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_W)) \{
00106         moveForward(speed);
00107     \}
00108     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_S)) \{
00109         moveBackward(speed);
00110     \}
00111     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_A)) \{
00112         moveLeft(speed);
00113     \}
00114     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_D)) \{
00115         moveRight(speed);
00116     \}
00117 
00118     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_SPACE)) \{
00119         transform->addTranslation(vec3(0, speed, 0));
00120     \}
00121     \textcolor{keywordflow}{if} (Keyboard::getKey(Keyboard::K\_LCTRL)) \{
00122         transform->addTranslation(vec3(0, -speed, 0));
00123     \}
00124 
00125     Mouse::hide();
00126 
00127     vec2 mousepos = Mouse::getMousePos();
00128     vec2 deltapos = vec2(mousepos.x - (Window::getWidth() / 2), mousepos.y - (Window::getHeight() / 2));
00129 
00130     transform->addRotation(vec3(0, -deltapos.y * mouse\_sensitivity, 0));
00131     transform->addRotation(vec3(deltapos.x    * mouse\_sensitivity, 0, 0));
00132 
00133     Mouse::setMousePos(Window::getWidth() / 2, Window::getHeight() / 2);
00134 \}
\end{DoxyCode}
